import{_ as i,o as a,c as t,ag as e}from"./chunks/framework.DEqXEGcv.js";const E=JSON.parse('{"title":"Database","description":"","frontmatter":{},"headers":[],"relativePath":"server/database.md","filePath":"server/database.md"}'),n={name:"server/database.md"};function l(h,s,p,r,k,d){return a(),t("div",null,[...s[0]||(s[0]=[e(`<h1 id="database" tabindex="-1">Database <a class="header-anchor" href="#database" aria-label="Permalink to &quot;Database&quot;">​</a></h1><p>Lux servers include built-in database support. SQLite is the default driver, with PostgreSQL and MySQL also available. Configuration is declarative, and query methods are available throughout your server code.</p><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><h3 id="sqlite-default" tabindex="-1">SQLite (Default) <a class="header-anchor" href="#sqlite-default" aria-label="Permalink to &quot;SQLite (Default)&quot;">​</a></h3><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./data.db&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>SQLite requires no external service -- the database is a single file. This is the recommended default for development and many production workloads.</p><h3 id="postgresql" tabindex="-1">PostgreSQL <a class="header-anchor" href="#postgresql" aria-label="Permalink to &quot;PostgreSQL&quot;">​</a></h3><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    driver: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgres&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgres://user:pass@localhost:5432/mydb&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="mysql" tabindex="-1">MySQL <a class="header-anchor" href="#mysql" aria-label="Permalink to &quot;MySQL&quot;">​</a></h3><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    driver: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mysql&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mysql://user:pass@localhost:3306/mydb&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Store database connection strings in environment variables rather than hardcoding them. Use the <code>env</code> declaration to load them at startup:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">env DATABASE_URL: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;sqlite:./data.db&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { url: DATABASE_URL }</span></span></code></pre></div></div><h2 id="query-methods" tabindex="-1">Query Methods <a class="header-anchor" href="#query-methods" aria-label="Permalink to &quot;Query Methods&quot;">​</a></h2><p>Lux provides four core query methods on the <code>db</code> object:</p><h3 id="db-query" tabindex="-1">db.query <a class="header-anchor" href="#db-query" aria-label="Permalink to &quot;db.query&quot;">​</a></h3><p>Execute a SELECT statement and return all matching rows as an array:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.query(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM users WHERE age &gt; ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.query(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM users WHERE active = ? AND role = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="db-get" tabindex="-1">db.get <a class="header-anchor" href="#db-get" aria-label="Permalink to &quot;db.get&quot;">​</a></h3><p>Execute a SELECT statement and return a single row (or <code>nil</code> if no match):</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id)</span></span></code></pre></div><h3 id="db-run" tabindex="-1">db.run <a class="header-anchor" href="#db-run" aria-label="Permalink to &quot;db.run&quot;">​</a></h3><p>Execute an INSERT, UPDATE, or DELETE statement. Returns metadata about the operation (e.g., rows affected, last insert ID):</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSERT INTO users (name, email) VALUES (?, ?)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name, email)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UPDATE users SET active = ? WHERE id = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user_id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DELETE FROM users WHERE last_login &lt; ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cutoff_date)</span></span></code></pre></div><h3 id="db-exec" tabindex="-1">db.exec <a class="header-anchor" href="#db-exec" aria-label="Permalink to &quot;db.exec&quot;">​</a></h3><p>Execute raw SQL statements, typically for DDL (schema changes). Does not support parameterized values:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.exec(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CREATE TABLE IF NOT EXISTS users (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  id INTEGER PRIMARY KEY AUTOINCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name TEXT NOT NULL,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  email TEXT UNIQUE NOT NULL,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  created_at DATETIME DEFAULT CURRENT_TIMESTAMP</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="parameter-substitution" tabindex="-1">Parameter Substitution <a class="header-anchor" href="#parameter-substitution" aria-label="Permalink to &quot;Parameter Substitution&quot;">​</a></h3><p>All parameterized methods (<code>query</code>, <code>get</code>, <code>run</code>) use <code>?</code> placeholders to prevent SQL injection:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Safe -- parameters are escaped</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.query(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM users WHERE name = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user_input)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NEVER do this -- vulnerable to SQL injection</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.query(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM users WHERE name = &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user_input</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="transactions" tabindex="-1">Transactions <a class="header-anchor" href="#transactions" aria-label="Permalink to &quot;Transactions&quot;">​</a></h2><p>Wrap multiple operations in a transaction to ensure atomicity. If any statement fails, the entire transaction rolls back:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.transaction(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSERT INTO orders (user_id, total) VALUES (?, ?)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user_id, total)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UPDATE inventory SET count = count - 1 WHERE id = ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, item_id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSERT INTO audit_log (action) VALUES (?)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;order_placed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>If the function completes without error, the transaction commits. If it throws, the transaction rolls back automatically.</p><h2 id="migrations" tabindex="-1">Migrations <a class="header-anchor" href="#migrations" aria-label="Permalink to &quot;Migrations&quot;">​</a></h2><p>Migrations let you evolve your database schema over time in a controlled, versioned way.</p><h3 id="creating-migrations" tabindex="-1">Creating Migrations <a class="header-anchor" href="#creating-migrations" aria-label="Permalink to &quot;Creating Migrations&quot;">​</a></h3><p>Use the CLI to generate a new migration file:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate:create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_users_table</span></span></code></pre></div><p>This creates a timestamped migration file that you can fill in with your schema changes.</p><h3 id="running-migrations" tabindex="-1">Running Migrations <a class="header-anchor" href="#running-migrations" aria-label="Permalink to &quot;Running Migrations&quot;">​</a></h3><p>Apply all pending migrations:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate:up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app.lux</span></span></code></pre></div><h3 id="checking-status" tabindex="-1">Checking Status <a class="header-anchor" href="#checking-status" aria-label="Permalink to &quot;Checking Status&quot;">​</a></h3><p>See which migrations have been applied and which are pending:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate:status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app.lux</span></span></code></pre></div><h3 id="auto-migration-on-startup" tabindex="-1">Auto-Migration on Startup <a class="header-anchor" href="#auto-migration-on-startup" aria-label="Permalink to &quot;Auto-Migration on Startup&quot;">​</a></h3><p>Run pending migrations automatically when the server starts:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./data.db&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.migrate()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This is convenient for development. For production, running migrations explicitly via the CLI gives you more control.</p><h2 id="race-protection" tabindex="-1">Race Protection <a class="header-anchor" href="#race-protection" aria-label="Permalink to &quot;Race Protection&quot;">​</a></h2><p>A global async mutex is available for protecting critical sections from concurrent access. Use <code>withLock</code> to serialize access:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update_counter() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    withLock(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT count FROM counters WHERE id = 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UPDATE counters SET count = ? WHERE id = 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, count.count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>withLock</code> ensures that only one invocation of the wrapped function runs at a time, even under concurrent requests. This prevents read-modify-write race conditions.</p><h2 id="practical-tips" tabindex="-1">Practical Tips <a class="header-anchor" href="#practical-tips" aria-label="Permalink to &quot;Practical Tips&quot;">​</a></h2><p><strong>Use transactions for multi-step writes.</strong> Any time you perform multiple related writes, wrap them in <code>db.transaction</code>. This prevents partial updates if something fails midway.</p><p><strong>Prefer parameterized queries.</strong> Always use <code>?</code> placeholders instead of string interpolation. This prevents SQL injection and handles type escaping correctly.</p><p><strong>Run migrations explicitly in production.</strong> While <code>db.migrate()</code> on startup is convenient for development, production deployments benefit from running <code>lux migrate:up</code> as a separate step so you can inspect and control the migration process.</p>`,56)])])}const c=i(n,[["render",l]]);export{E as __pageData,c as default};
