import{_ as i,o as e,c as a,ag as t}from"./chunks/framework.DEqXEGcv.js";const k=JSON.parse('{"title":"LSP Server","description":"","frontmatter":{"title":"LSP Server"},"headers":[],"relativePath":"editor/lsp.md","filePath":"editor/lsp.md"}'),n={name:"editor/lsp.md"};function l(r,s,o,h,p,d){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="lsp-server" tabindex="-1">LSP Server <a class="header-anchor" href="#lsp-server" aria-label="Permalink to &quot;LSP Server&quot;">​</a></h1><p>Lux includes a built-in Language Server Protocol (LSP) server that provides rich editor support. The server communicates via JSON-RPC over stdio and works with any LSP-compatible editor.</p><h2 id="starting-the-server" tabindex="-1">Starting the Server <a class="header-anchor" href="#starting-the-server" aria-label="Permalink to &quot;Starting the Server&quot;">​</a></h2><p>The LSP server is typically started by your editor automatically. You can also start it manually:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lsp</span></span></code></pre></div><p>Or directly:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/lsp/server.js</span></span></code></pre></div><h2 id="capabilities" tabindex="-1">Capabilities <a class="header-anchor" href="#capabilities" aria-label="Permalink to &quot;Capabilities&quot;">​</a></h2><h3 id="diagnostics" tabindex="-1">Diagnostics <a class="header-anchor" href="#diagnostics" aria-label="Permalink to &quot;Diagnostics&quot;">​</a></h3><p>The server analyzes <code>.lux</code> files on every change and reports errors and warnings in real time:</p><ul><li><strong>Syntax errors</strong> -- Invalid tokens, unexpected characters, malformed expressions</li><li><strong>Parse errors</strong> -- Missing braces, incorrect block structure, invalid patterns</li><li><strong>Type warnings</strong> -- Undefined identifiers, unused variables (in function scopes)</li><li><strong>Exhaustive match warnings</strong> -- Uncovered Result/Option/custom type variants</li></ul><p>Diagnostics use Lux&#39;s rich error message system with precise source locations. The server supports parser error recovery, providing diagnostics for multiple errors in a single file rather than stopping at the first one.</p><h3 id="completion" tabindex="-1">Completion <a class="header-anchor" href="#completion" aria-label="Permalink to &quot;Completion&quot;">​</a></h3><p>Triggered by typing or by pressing <code>Ctrl+Space</code>, completion provides suggestions for:</p><ul><li><strong>Keywords</strong> -- <code>fn</code>, <code>let</code>, <code>if</code>, <code>elif</code>, <code>else</code>, <code>for</code>, <code>while</code>, <code>match</code>, <code>type</code>, <code>import</code>, <code>server</code>, <code>client</code>, <code>shared</code>, <code>pub</code>, <code>mut</code>, <code>async</code>, <code>await</code>, <code>guard</code>, <code>interface</code>, <code>derive</code>, <code>route</code>, <code>model</code>, <code>db</code>, and more</li><li><strong>Built-in functions</strong> -- <code>print</code>, <code>len</code>, <code>range</code>, <code>enumerate</code>, <code>sum</code>, <code>sorted</code>, <code>reversed</code>, <code>zip</code>, <code>min</code>, <code>max</code>, <code>type_of</code>, <code>filter</code>, <code>map</code></li><li><strong>Result/Option constructors</strong> -- <code>Ok</code>, <code>Err</code>, <code>Some</code>, <code>None</code></li><li><strong>User-defined symbols</strong> -- Functions, types, and variables defined in the current file</li></ul><p>Trigger characters: <code>.</code>, <code>&quot;</code>, <code>&#39;</code>, <code>/</code>, <code>&lt;</code></p><p>Results are limited to 50 items for performance.</p><h3 id="go-to-definition" tabindex="-1">Go to Definition <a class="header-anchor" href="#go-to-definition" aria-label="Permalink to &quot;Go to Definition&quot;">​</a></h3><p>Jump to the definition of any identifier in the current file. The server looks up symbols in the analyzer&#39;s scope chain, resolving through nested scopes to find the original declaration.</p><p>Supported for:</p><ul><li>Function definitions</li><li>Variable bindings</li><li>Type declarations</li><li>Function parameters</li></ul><h3 id="hover" tabindex="-1">Hover <a class="header-anchor" href="#hover" aria-label="Permalink to &quot;Hover&quot;">​</a></h3><p>Hover over any identifier to see information about it:</p><ul><li><p><strong>Built-in functions</strong> show their signature and a brief description:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>fn len(value) -- Get length of string, array, or object</span></span></code></pre></div></li><li><p><strong>User-defined symbols</strong> show their kind (function, variable, type), type annotations if present, and parameter lists for functions.</p></li></ul><h3 id="signature-help" tabindex="-1">Signature Help <a class="header-anchor" href="#signature-help" aria-label="Permalink to &quot;Signature Help&quot;">​</a></h3><p>When typing inside a function call&#39;s parentheses, a popup displays the function signature with the current parameter highlighted.</p><p>Trigger characters: <code>(</code>, <code>,</code></p><p>Built-in functions include full parameter documentation. User-defined functions show parameter names extracted from their definition.</p><h3 id="document-formatting" tabindex="-1">Document Formatting <a class="header-anchor" href="#document-formatting" aria-label="Permalink to &quot;Document Formatting&quot;">​</a></h3><p>Format the entire document using the Lux formatter. This is the same formatter available via <code>lux fmt</code> on the command line.</p><h3 id="rename" tabindex="-1">Rename <a class="header-anchor" href="#rename" aria-label="Permalink to &quot;Rename&quot;">​</a></h3><p>Rename a symbol across the document. The server finds all references to the symbol and returns the appropriate text edits.</p><h3 id="find-references" tabindex="-1">Find References <a class="header-anchor" href="#find-references" aria-label="Permalink to &quot;Find References&quot;">​</a></h3><p>Find all locations where a symbol is used within the current document.</p><h3 id="workspace-symbols" tabindex="-1">Workspace Symbols <a class="header-anchor" href="#workspace-symbols" aria-label="Permalink to &quot;Workspace Symbols&quot;">​</a></h3><p>Search for symbols (functions, types, variables) across all open documents in the workspace.</p><h2 id="protocol-details" tabindex="-1">Protocol Details <a class="header-anchor" href="#protocol-details" aria-label="Permalink to &quot;Protocol Details&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>Transport</td><td>stdio (JSON-RPC)</td></tr><tr><td>Text sync</td><td>Full document sync (change mode 1)</td></tr><tr><td>Encoding</td><td>UTF-8</td></tr></tbody></table><p>The server handles the standard LSP lifecycle:</p><ol><li><code>initialize</code> -- Server reports capabilities</li><li><code>initialized</code> -- Client confirms</li><li><code>textDocument/didOpen</code> -- Document opened, initial validation</li><li><code>textDocument/didChange</code> -- Document changed, re-validation</li><li><code>textDocument/didSave</code> -- Document saved, re-validation</li><li><code>shutdown</code> / <code>exit</code> -- Graceful termination</li></ol><h2 id="multi-editor-support" tabindex="-1">Multi-Editor Support <a class="header-anchor" href="#multi-editor-support" aria-label="Permalink to &quot;Multi-Editor Support&quot;">​</a></h2><p>The LSP server works with any editor that supports the Language Server Protocol:</p><h3 id="vs-code" tabindex="-1">VS Code <a class="header-anchor" href="#vs-code" aria-label="Permalink to &quot;VS Code&quot;">​</a></h3><p>See the <a href="./vscode.html">VS Code Extension</a> page -- the extension handles starting and connecting to the LSP server automatically.</p><h3 id="neovim" tabindex="-1">Neovim <a class="header-anchor" href="#neovim" aria-label="Permalink to &quot;Neovim&quot;">​</a></h3><p>Using <a href="https://github.com/neovim/nvim-lspconfig" target="_blank" rel="noreferrer">nvim-lspconfig</a>:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lspconfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lspconfig&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> configs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lspconfig.configs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">configs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  default_config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cmd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bun&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;run&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/path/to/lux-lang/src/lsp/server.js&#39; </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filetypes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lux&#39; </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    root_dir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lspconfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">root_pattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;package.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lspconfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({})</span></span></code></pre></div><p>Add a file type detection autocmd:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filetype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  extension </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lux </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;lux&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="emacs" tabindex="-1">Emacs <a class="header-anchor" href="#emacs" aria-label="Permalink to &quot;Emacs&quot;">​</a></h3><p>Using <a href="https://github.com/emacs-lsp/lsp-mode" target="_blank" rel="noreferrer">lsp-mode</a>:</p><div class="language-elisp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">elisp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">with-eval-after-load</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &#39;lsp-mode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add-to-list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &#39;lsp-language-id-configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &#39;(lux-mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lux&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (lsp-register-client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   (make-lsp-client</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :new-connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (lsp-stdio-connection &#39;(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bun&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;run&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/path/to/lux-lang/src/lsp/server.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :major-modes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &#39;(lux-mode)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :server-id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &#39;lux-ls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span></span></code></pre></div><h3 id="helix" tabindex="-1">Helix <a class="header-anchor" href="#helix" aria-label="Permalink to &quot;Helix&quot;">​</a></h3><p>In <code>languages.toml</code>:</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">language</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lux&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scope = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;source.lux&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">file-types = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lux&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">language-servers = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lux-ls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">language-server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux-ls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">command = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bun&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/path/to/lux-lang/src/lsp/server.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h2 id="error-recovery" tabindex="-1">Error Recovery <a class="header-anchor" href="#error-recovery" aria-label="Permalink to &quot;Error Recovery&quot;">​</a></h2><p>The LSP server is designed for resilience:</p><ul><li><strong>Parser error recovery</strong> -- When a file has syntax errors, the server uses the partial AST to still provide completions, hover, and go-to-definition for the valid portions of the file.</li><li><strong>Crash recovery</strong> -- Uncaught exceptions and unhandled promise rejections are caught and logged rather than crashing the server process.</li><li><strong>Cache management</strong> -- The server caches up to 100 document analyses with LRU eviction, preferring to keep open documents in cache.</li></ul>`,58)])])}const g=i(n,[["render",l]]);export{k as __pageData,g as default};
