import{_ as a,o as i,c as e,ag as n}from"./chunks/framework.DEqXEGcv.js";const k=JSON.parse('{"title":"Compilation","description":"","frontmatter":{},"headers":[],"relativePath":"fullstack/compilation.md","filePath":"fullstack/compilation.md"}'),t={name:"fullstack/compilation.md"};function l(p,s,h,r,o,d){return i(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="compilation" tabindex="-1">Compilation <a class="header-anchor" href="#compilation" aria-label="Permalink to &quot;Compilation&quot;">​</a></h1><p>This page explains what happens when you run <code>lux build</code> or <code>lux dev</code>, what files are generated, and how the production build pipeline works.</p><h2 id="build-command" tabindex="-1">Build Command <a class="header-anchor" href="#build-command" aria-label="Permalink to &quot;Build Command&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [src_dir] [--output dir] [--production]</span></span></code></pre></div><p>By default, <code>lux build</code> compiles all <code>.lux</code> files in the current directory and writes output to <code>.lux-out/</code>.</p><table tabindex="0"><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>--output</code>, <code>-o</code></td><td>Output directory (default: <code>.lux-out</code>)</td></tr><tr><td><code>--production</code></td><td>Production build with bundling, hashing, and minification</td></tr><tr><td><code>--watch</code></td><td>Watch for file changes and rebuild</td></tr></tbody></table><h2 id="output-structure" tabindex="-1">Output Structure <a class="header-anchor" href="#output-structure" aria-label="Permalink to &quot;Output Structure&quot;">​</a></h2><p>For a file named <code>app.lux</code> with all three blocks:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.lux-out/</span></span>
<span class="line"><span>  app.shared.js             # Shared types and functions</span></span>
<span class="line"><span>  app.server.js             # Server code (Bun.serve)</span></span>
<span class="line"><span>  app.client.js             # Client code (reactive runtime)</span></span>
<span class="line"><span>  runtime/</span></span>
<span class="line"><span>    reactivity.js           # Reactive runtime (signals, effects, DOM)</span></span>
<span class="line"><span>    rpc.js                  # RPC bridge client</span></span>
<span class="line"><span>    router.js               # Client-side router</span></span></code></pre></div><p>With named blocks, additional files are generated:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.lux-out/</span></span>
<span class="line"><span>  app.shared.js</span></span>
<span class="line"><span>  app.server.js             # Default (unnamed) server</span></span>
<span class="line"><span>  app.server.api.js         # server &quot;api&quot; { }</span></span>
<span class="line"><span>  app.server.events.js      # server &quot;events&quot; { }</span></span>
<span class="line"><span>  app.client.js</span></span>
<span class="line"><span>  runtime/</span></span>
<span class="line"><span>    reactivity.js</span></span>
<span class="line"><span>    rpc.js</span></span>
<span class="line"><span>    router.js</span></span></code></pre></div><p>If only some blocks exist, only their corresponding files are generated. A file with only <code>server {}</code> produces only <code>app.server.js</code> and <code>app.shared.js</code> (if a shared block exists).</p><h2 id="server-output" tabindex="-1">Server Output <a class="header-anchor" href="#server-output" aria-label="Permalink to &quot;Server Output&quot;">​</a></h2><p>The server file (<code>app.server.js</code>) is a standalone Bun script. It contains:</p><ol><li><strong>Import of shared code</strong> -- <code>import ... from &#39;./app.shared.js&#39;</code></li><li><strong>Standard library functions</strong> -- inline runtime utilities</li><li><strong>Database setup</strong> -- SQLite connection, model registration (if <code>db</code> and <code>model</code> declarations exist)</li><li><strong>Server functions</strong> -- all functions defined in the server block</li><li><strong>RPC endpoints</strong> -- <code>POST /rpc/&lt;name&gt;</code> for each server function</li><li><strong>Route handlers</strong> -- explicit <code>route GET &quot;/path&quot; =&gt; handler</code> declarations</li><li><strong>Middleware</strong> -- request logging, CORS, auth, etc.</li><li><strong>HTTP server startup</strong> -- <code>Bun.serve()</code> with the configured port and request handler</li><li><strong>Client HTML serving</strong> -- the root route (<code>/</code>) serves the client HTML page</li></ol><h3 id="how-the-server-starts" tabindex="-1">How the Server Starts <a class="header-anchor" href="#how-the-server-starts" aria-label="Permalink to &quot;How the Server Starts&quot;">​</a></h3><p>The generated server file ends with a <code>Bun.serve()</code> call:</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Bun.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  port: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Match routes, RPC endpoints, static files</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Falls back to serving client HTML at /</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Routes are matched in order of specificity: static paths first, then parameterized paths (<code>:id</code>), then wildcards (<code>*</code>). RPC endpoints (<code>/rpc/&lt;name&gt;</code>) are registered before explicit routes.</p><h3 id="running-the-server" tabindex="-1">Running the Server <a class="header-anchor" href="#running-the-server" aria-label="Permalink to &quot;Running the Server&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Direct execution</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .lux-out/app.server.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># With custom port</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">8080</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .lux-out/app.server.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Or use the dev server (recommended for development)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><h2 id="client-output" tabindex="-1">Client Output <a class="header-anchor" href="#client-output" aria-label="Permalink to &quot;Client Output&quot;">​</a></h2><p>The client file (<code>app.client.js</code>) is a JavaScript module that gets embedded into an HTML page. It contains:</p><ol><li><strong>Runtime imports</strong> -- <code>createSignal</code>, <code>createEffect</code>, <code>createComputed</code>, <code>mount</code>, and other reactive primitives from <code>runtime/reactivity.js</code></li><li><strong>RPC import</strong> -- <code>rpc</code> function from <code>runtime/rpc.js</code></li><li><strong>Shared code</strong> -- inlined shared types and functions</li><li><strong>Standard library</strong> -- inline stdlib utilities</li><li><strong>Server RPC proxy</strong> -- <code>const server = new Proxy(...)</code> for transparent RPC</li><li><strong>Reactive state</strong> -- <code>createSignal()</code> calls for each <code>state</code> declaration</li><li><strong>Computed values</strong> -- <code>createComputed()</code> calls for each <code>computed</code> declaration</li><li><strong>Functions</strong> -- client-side functions and event handlers</li><li><strong>Effects</strong> -- <code>createEffect()</code> calls, auto-wrapped as <code>async</code> if they contain RPC calls</li><li><strong>Components</strong> -- component functions using the <code>lux_el()</code> virtual DOM helper</li><li><strong>Mount call</strong> -- <code>mount(App, document.getElementById(&quot;app&quot;))</code> to start the application</li></ol><h3 id="state-compilation" tabindex="-1">State Compilation <a class="header-anchor" href="#state-compilation" aria-label="Permalink to &quot;State Compilation&quot;">​</a></h3><p>Lux reactive state compiles to SolidJS-style signal pairs:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;World&quot;</span></span></code></pre></div><p>Becomes:</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>In generated code:</p><ul><li><strong>Reading</strong> <code>count</code> becomes <code>count()</code> (calling the getter)</li><li><strong>Writing</strong> <code>count = 5</code> becomes <code>setCount(5)</code> (calling the setter)</li><li><strong>Compound</strong> <code>count += 1</code> becomes <code>setCount(count() + 1)</code></li></ul><h3 id="html-generation" tabindex="-1">HTML Generation <a class="header-anchor" href="#html-generation" aria-label="Permalink to &quot;HTML Generation&quot;">​</a></h3><p>The client JS is embedded into an HTML page. During development, <code>lux dev</code> generates an HTML file like:</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> charset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;viewport&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;width=device-width, initial-scale=1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Lux App&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Reactive runtime inlined here</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // RPC runtime inlined here</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Client code inlined here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>The runtime is inlined directly into the HTML so there are no extra network requests during development. The server serves this HTML at the root route (<code>/</code>).</p><h2 id="shared-output" tabindex="-1">Shared Output <a class="header-anchor" href="#shared-output" aria-label="Permalink to &quot;Shared Output&quot;">​</a></h2><p>The shared file (<code>app.shared.js</code>) contains plain JavaScript from the <code>shared {}</code> block. Both the server and client import from it:</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app.shared.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { id, name, email };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> validate_email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> email.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>If the shared block is empty or absent, no <code>app.shared.js</code> file is generated.</p><h2 id="dev-server" tabindex="-1">Dev Server <a class="header-anchor" href="#dev-server" aria-label="Permalink to &quot;Dev Server&quot;">​</a></h2><p><code>lux dev</code> provides a complete development experience:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [src_dir] [--port 3000]</span></span></code></pre></div><p>The dev server performs the following steps:</p><h3 id="_1-compile" tabindex="-1">1. Compile <a class="header-anchor" href="#_1-compile" aria-label="Permalink to &quot;1. Compile&quot;">​</a></h3><p>All <code>.lux</code> files in the source directory are compiled. Output goes to <code>.lux-out/</code> inside the source directory.</p><h3 id="_2-copy-runtime" tabindex="-1">2. Copy Runtime <a class="header-anchor" href="#_2-copy-runtime" aria-label="Permalink to &quot;2. Copy Runtime&quot;">​</a></h3><p>Runtime files (<code>reactivity.js</code>, <code>rpc.js</code>, <code>router.js</code>) are copied from the Lux installation to <code>.lux-out/runtime/</code>.</p><h3 id="_3-generate-html" tabindex="-1">3. Generate HTML <a class="header-anchor" href="#_3-generate-html" aria-label="Permalink to &quot;3. Generate HTML&quot;">​</a></h3><p>For each client block, the dev server generates an <code>index.html</code> file with the reactive runtime and client code inlined as a module script.</p><h3 id="_4-start-server-processes" tabindex="-1">4. Start Server Processes <a class="header-anchor" href="#_4-start-server-processes" aria-label="Permalink to &quot;4. Start Server Processes&quot;">​</a></h3><p>Each server block (default and named) is spawned as a separate Bun child process with its assigned port:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Starting server on port 3000</span></span>
<span class="line"><span>Starting server:api on port 3001</span></span>
<span class="line"><span>Starting server:events on port 3002</span></span></code></pre></div><p>The default server serves the client HTML on <code>/</code> and handles all routes and RPC endpoints. Named servers handle their own routes.</p><h3 id="_5-watch-for-changes" tabindex="-1">5. Watch for Changes <a class="header-anchor" href="#_5-watch-for-changes" aria-label="Permalink to &quot;5. Watch for Changes&quot;">​</a></h3><p>The dev server watches for <code>.lux</code> file changes using a file watcher with debounce. When a file changes:</p><ol><li>All server processes are killed</li><li>All <code>.lux</code> files are recompiled</li><li>New server processes are spawned</li><li>The page in the browser needs a manual refresh (no hot module replacement yet)</li></ol><h3 id="dev-server-output-example" tabindex="-1">Dev Server Output Example <a class="header-anchor" href="#dev-server-output-example" aria-label="Permalink to &quot;Dev Server Output Example&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  Lux dev server starting...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Compiled 1 file(s)</span></span>
<span class="line"><span>  Output: .lux-out/</span></span>
<span class="line"><span>  Starting server on port 3000</span></span>
<span class="line"><span>  Client: .lux-out/index.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  1 server process(es) running</span></span>
<span class="line"><span>    -&gt; server: http://localhost:3000</span></span></code></pre></div><h2 id="production-build" tabindex="-1">Production Build <a class="header-anchor" href="#production-build" aria-label="Permalink to &quot;Production Build&quot;">​</a></h2><p><code>lux build --production</code> generates optimized output for deployment:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --production</span></span></code></pre></div><h3 id="what-production-build-does" tabindex="-1">What Production Build Does <a class="header-anchor" href="#what-production-build-does" aria-label="Permalink to &quot;What Production Build Does&quot;">​</a></h3><ol><li><strong>Compiles</strong> all <code>.lux</code> files</li><li><strong>Bundles</strong> all server code into a single file, all client code into a single file, all shared code into a single file</li><li><strong>Inlines</strong> the reactive runtime and RPC runtime into the client bundle (eliminating import statements)</li><li><strong>Hashes</strong> output filenames for cache busting: <code>server.&lt;hash&gt;.js</code>, <code>client.&lt;hash&gt;.js</code></li><li><strong>Minifies</strong> client JavaScript using Bun&#39;s built-in bundler (<code>Bun.build</code> with <code>minify: true</code>)</li><li><strong>Generates</strong> production HTML referencing the hashed client bundle</li></ol><h3 id="production-output-structure" tabindex="-1">Production Output Structure <a class="header-anchor" href="#production-output-structure" aria-label="Permalink to &quot;Production Output Structure&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.lux-out/</span></span>
<span class="line"><span>  server.a1b2c3d4e5f6.js        # Bundled server (stdlib + shared + server code)</span></span>
<span class="line"><span>  client.f6e5d4c3b2a1.js        # Bundled client (runtime + shared + client code)</span></span>
<span class="line"><span>  client.f6e5d4c3b2a1.min.js    # Minified client</span></span>
<span class="line"><span>  index.html                     # Production HTML referencing hashed client JS</span></span></code></pre></div><h3 id="content-hashing" tabindex="-1">Content Hashing <a class="header-anchor" href="#content-hashing" aria-label="Permalink to &quot;Content Hashing&quot;">​</a></h3><p>File hashes are generated using SHA-256 (first 12 hex characters). The hash changes whenever the file content changes, enabling long-lived cache headers:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cache-Control: public, max-age=31536000, immutable</span></span></code></pre></div><h3 id="production-html" tabindex="-1">Production HTML <a class="header-anchor" href="#production-html" aria-label="Permalink to &quot;Production HTML&quot;">​</a></h3><p>The generated <code>index.html</code> is minimal:</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> charset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;viewport&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;width=device-width, initial-scale=1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Lux App&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;client.f6e5d4c3b2a1.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="running-in-production" tabindex="-1">Running in Production <a class="header-anchor" href="#running-in-production" aria-label="Permalink to &quot;Running in Production&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --production</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run the server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .lux-out/server.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.js</span></span></code></pre></div><p>The production server is a standalone Bun script, same as development. It serves the client HTML and handles all routes and RPC endpoints.</p><h2 id="source-maps" tabindex="-1">Source Maps <a class="header-anchor" href="#source-maps" aria-label="Permalink to &quot;Source Maps&quot;">​</a></h2><p>The build pipeline generates source maps for debugging. When the compiler emits code, it tracks source-to-output line mappings and writes <code>.map</code> files alongside the JavaScript output:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.lux-out/</span></span>
<span class="line"><span>  app.server.js</span></span>
<span class="line"><span>  app.server.js.map          # Source map for server</span></span>
<span class="line"><span>  app.client.js</span></span>
<span class="line"><span>  app.client.js.map          # Source map for client</span></span></code></pre></div><p>Source maps use the standard VLQ-encoded format and reference the original <code>.lux</code> file. The JavaScript output includes a <code>//# sourceMappingURL=</code> comment pointing to the map file.</p><p>This means that when debugging in browser devtools or in a Bun error stack trace, line numbers point back to the original <code>.lux</code> source rather than the generated JavaScript.</p><h3 id="source-map-structure" tabindex="-1">Source Map Structure <a class="header-anchor" href="#source-map-structure" aria-label="Permalink to &quot;Source Map Structure&quot;">​</a></h3><p>The Lux compiler uses a <code>SourceMapBuilder</code> class that tracks <code>(sourceLine, sourceCol) -&gt; (outputLine, outputCol)</code> mappings during code generation. Each code generator method (<code>genExpression</code>, <code>genStatement</code>, etc.) records these mappings via a <code>_sourceMappings</code> array in the base codegen.</p><h2 id="multi-file-projects" tabindex="-1">Multi-File Projects <a class="header-anchor" href="#multi-file-projects" aria-label="Permalink to &quot;Multi-File Projects&quot;">​</a></h2><p>For projects with multiple <code>.lux</code> files, <code>lux build</code> compiles each file independently. Import resolution connects them:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// models.lux</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">shared</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { id: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app.lux</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./models&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_users() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The <code>compileWithImports()</code> function resolves <code>.lux</code> imports, compiles dependencies, and rewrites import paths to point to the generated <code>.js</code> files. Circular imports are detected and reported as errors.</p><h3 id="output-for-multi-file-projects" tabindex="-1">Output for Multi-File Projects <a class="header-anchor" href="#output-for-multi-file-projects" aria-label="Permalink to &quot;Output for Multi-File Projects&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.lux-out/</span></span>
<span class="line"><span>  models.shared.js</span></span>
<span class="line"><span>  app.shared.js</span></span>
<span class="line"><span>  app.server.js       # imports from models.shared.js</span></span>
<span class="line"><span>  app.client.js</span></span>
<span class="line"><span>  runtime/</span></span>
<span class="line"><span>    ...</span></span></code></pre></div><h2 id="build-pipeline-summary" tabindex="-1">Build Pipeline Summary <a class="header-anchor" href="#build-pipeline-summary" aria-label="Permalink to &quot;Build Pipeline Summary&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  .lux source file(s)</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>  +-------------+</span></span>
<span class="line"><span>  | Lexer       |  Tokenize source</span></span>
<span class="line"><span>  +-------------+</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>  +-------------+</span></span>
<span class="line"><span>  | Parser      |  Build AST</span></span>
<span class="line"><span>  +-------------+</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>  +-------------+</span></span>
<span class="line"><span>  | Analyzer    |  Validate, warn on issues</span></span>
<span class="line"><span>  +-------------+</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>  +-------------------+     +-------------------+     +--------------------+</span></span>
<span class="line"><span>  | ServerCodegen     |     | ClientCodegen     |     | SharedCodegen      |</span></span>
<span class="line"><span>  | - RPC endpoints   |     | - Reactive state  |     | - Types            |</span></span>
<span class="line"><span>  | - Routes          |     | - Components      |     | - Validation       |</span></span>
<span class="line"><span>  | - DB setup        |     | - RPC proxy       |     | - Constants        |</span></span>
<span class="line"><span>  | - Bun.serve()     |     | - mount()         |     |                    |</span></span>
<span class="line"><span>  +-------------------+     +-------------------+     +--------------------+</span></span>
<span class="line"><span>         |                         |                         |</span></span>
<span class="line"><span>         v                         v                         v</span></span>
<span class="line"><span>  app.server.js            app.client.js              app.shared.js</span></span>
<span class="line"><span>                                  |</span></span>
<span class="line"><span>                                  v</span></span>
<span class="line"><span>                            index.html</span></span>
<span class="line"><span>                   (runtime + client inlined)</span></span></code></pre></div><h2 id="related-pages" tabindex="-1">Related Pages <a class="header-anchor" href="#related-pages" aria-label="Permalink to &quot;Related Pages&quot;">​</a></h2><ul><li><a href="./architecture.html">Architecture Overview</a> -- the three-block model</li><li><a href="./server-block.html">Server Block</a> -- what goes in the server output</li><li><a href="./client-block.html">Client Block</a> -- what goes in the client output</li><li><a href="./shared-block.html">Shared Block</a> -- what goes in the shared output</li><li><a href="./named-blocks.html">Named Blocks</a> -- multi-server compilation</li><li><a href="./rpc.html">RPC Bridge</a> -- how RPC endpoints are generated</li></ul>`,91)])])}const u=a(t,[["render",l]]);export{k as __pageData,u as default};
