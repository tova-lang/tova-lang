import{_ as e,o as a,c as i,ag as t}from"./chunks/framework.DEqXEGcv.js";const u=JSON.parse('{"title":"Build System","description":"","frontmatter":{"title":"Build System"},"headers":[],"relativePath":"tooling/build.md","filePath":"tooling/build.md"}'),n={name:"tooling/build.md"};function l(p,s,d,r,o,c){return a(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="build-system" tabindex="-1">Build System <a class="header-anchor" href="#build-system" aria-label="Permalink to &quot;Build System&quot;">​</a></h1><p>The Lux build system compiles <code>.lux</code> source files into JavaScript, handling shared types, server blocks, client blocks, and runtime dependencies.</p><h2 id="basic-build" tabindex="-1">Basic Build <a class="header-anchor" href="#basic-build" aria-label="Permalink to &quot;Basic Build&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist</span></span></code></pre></div><p>By default, <code>lux build</code> compiles all <code>.lux</code> files in the current directory and outputs JavaScript to <code>.lux-out/</code>.</p><h2 id="output-structure" tabindex="-1">Output Structure <a class="header-anchor" href="#output-structure" aria-label="Permalink to &quot;Output Structure&quot;">​</a></h2><p>After building, the <code>.lux-out/</code> directory contains:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.lux-out/</span></span>
<span class="line"><span>  app.shared.js          # Shared types and functions</span></span>
<span class="line"><span>  app.server.js          # Default server block</span></span>
<span class="line"><span>  app.server.api.js      # Named server block &quot;api&quot;</span></span>
<span class="line"><span>  app.server.events.js   # Named server block &quot;events&quot;</span></span>
<span class="line"><span>  app.client.js          # Default client block</span></span>
<span class="line"><span>  runtime/</span></span>
<span class="line"><span>    reactivity.js        # Reactive state runtime</span></span>
<span class="line"><span>    rpc.js               # Server RPC client</span></span>
<span class="line"><span>    router.js            # Client-side router</span></span></code></pre></div><p>Each <code>.lux</code> source file produces up to several output files:</p><table tabindex="0"><thead><tr><th>Output</th><th>Source</th><th>Description</th></tr></thead><tbody><tr><td><code>&lt;name&gt;.shared.js</code></td><td><code>shared { ... }</code></td><td>Types and functions available to both server and client</td></tr><tr><td><code>&lt;name&gt;.server.js</code></td><td><code>server { ... }</code></td><td>Default server block code</td></tr><tr><td><code>&lt;name&gt;.server.&lt;block&gt;.js</code></td><td><code>server &quot;&lt;block&gt;&quot; { ... }</code></td><td>Named server blocks</td></tr><tr><td><code>&lt;name&gt;.client.js</code></td><td><code>client { ... }</code></td><td>Default client block code</td></tr><tr><td><code>&lt;name&gt;.client.&lt;block&gt;.js</code></td><td><code>client &quot;&lt;block&gt;&quot; { ... }</code></td><td>Named client blocks</td></tr></tbody></table><h2 id="production-builds" tabindex="-1">Production Builds <a class="header-anchor" href="#production-builds" aria-label="Permalink to &quot;Production Builds&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --production</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --production</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dist</span></span></code></pre></div><p>Production builds apply three optimizations:</p><ol><li><p><strong>Bundling</strong> -- All imports and dependencies are resolved and inlined into single output files, eliminating the need for a module loader at runtime.</p></li><li><p><strong>Content Hashing</strong> -- Output filenames include content hashes (e.g., <code>app.client.a1b2c3d4.js</code>) for cache-busting. When file contents change, the hash changes, ensuring browsers fetch the new version.</p></li><li><p><strong>Minification</strong> -- Whitespace, comments, and unnecessary characters are removed to reduce file size.</p></li></ol><h2 id="source-maps" tabindex="-1">Source Maps <a class="header-anchor" href="#source-maps" aria-label="Permalink to &quot;Source Maps&quot;">​</a></h2><p>The build system generates source maps for compiled files. Each <code>.js</code> output file gets a corresponding <code>.js.map</code> file that maps back to the original <code>.lux</code> source.</p><p>Source maps are appended as a <code>sourceMappingURL</code> comment:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Generated JavaScript code...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//# sourceMappingURL=app.server.js.map</span></span></code></pre></div><p>This enables debugging in browser DevTools and editor integrations that can step through the original Lux source.</p><h2 id="multi-file-projects" tabindex="-1">Multi-File Projects <a class="header-anchor" href="#multi-file-projects" aria-label="Permalink to &quot;Multi-File Projects&quot;">​</a></h2><p>For projects with multiple <code>.lux</code> files that import from each other, the build system uses <code>compileWithImports</code> to resolve the dependency graph:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// utils.lux</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">shared</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> format_date(d) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app.lux</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { format_date } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./utils&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_post() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    post </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fetch_post()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    post.date </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> format_date(post.created_at)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    post</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>During compilation:</p><ul><li><code>.lux</code> imports are discovered and compiled first</li><li>Import paths are rewritten from <code>.lux</code> to <code>.js</code> in the output</li><li>Circular dependencies are detected and reported as errors</li><li>A compilation cache prevents re-compiling files that have already been processed</li></ul><h2 id="runtime-files" tabindex="-1">Runtime Files <a class="header-anchor" href="#runtime-files" aria-label="Permalink to &quot;Runtime Files&quot;">​</a></h2><p>The build copies Lux runtime files into the output <code>runtime/</code> directory:</p><table tabindex="0"><thead><tr><th>File</th><th>Purpose</th></tr></thead><tbody><tr><td><code>reactivity.js</code></td><td>Reactive state management (<code>state</code>, <code>computed</code>, <code>effect</code>)</td></tr><tr><td><code>rpc.js</code></td><td>Client-to-server RPC call infrastructure</td></tr><tr><td><code>router.js</code></td><td>Client-side URL routing</td></tr></tbody></table><p>These are automatically imported by the generated server and client code.</p><h2 id="named-server-block-output" tabindex="-1">Named Server Block Output <a class="header-anchor" href="#named-server-block-output" aria-label="Permalink to &quot;Named Server Block Output&quot;">​</a></h2><p>When using multiple named server blocks, each gets its own output file:</p><div class="language-lux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  route</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/api/users&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list_users</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;events&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // WebSocket server</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This compiles to:</p><ul><li><code>app.server.api.js</code> -- the API server</li><li><code>app.server.events.js</code> -- the events server</li></ul><p>Each named server runs as a separate process on its own port, configurable via <code>PORT_&lt;NAME&gt;</code> environment variables (e.g., <code>PORT_API=3001</code>, <code>PORT_EVENTS=3002</code>).</p><h2 id="build-errors" tabindex="-1">Build Errors <a class="header-anchor" href="#build-errors" aria-label="Permalink to &quot;Build Errors&quot;">​</a></h2><p>When compilation fails, the build reports errors with Rust/Elm-style diagnostics including source context and caret markers pointing to the exact location:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>error: Undefined identifier &#39;usrName&#39;</span></span>
<span class="line"><span>  --&gt; src/app.lux:12:5</span></span>
<span class="line"><span>   |</span></span>
<span class="line"><span>12 |     print(usrName)</span></span>
<span class="line"><span>   |           ^^^^^^^ Did you mean &#39;userName&#39;?</span></span></code></pre></div><p>The build continues compiling remaining files even when individual files fail, reporting a summary at the end:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  Build complete. 4/5 succeeded.</span></span></code></pre></div><p>Use <code>--debug</code> for full stack traces on compilation errors.</p>`,41)])])}const k=e(n,[["render",l]]);export{u as __pageData,k as default};
